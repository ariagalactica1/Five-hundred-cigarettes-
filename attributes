-- LocalScript in StarterPlayer > StarterPlayerScripts
-- Scans the entire game for anything related to "Exposure"

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

--------------------------------------------------
-- Helper functions (matching your original style)
--------------------------------------------------

local function getPlayerAttr(targetPlayer, attrName)
	if not targetPlayer then return nil end
	local success, result = pcall(function()
		return targetPlayer:GetAttribute(attrName)
	end)
	if success and result ~= nil then
		return result
	end
	return nil
end

local function getCharAttr(char, attrName)
	if not char then return nil end
	local success, result = pcall(function()
		return char:GetAttribute(attrName)
	end)
	if success and result ~= nil then
		return result
	end
	return nil
end

local function getDataValue(targetPlayer, valueName)
	if not targetPlayer then return nil end
	local success, result = pcall(function()
		local data = targetPlayer:FindFirstChild("Data")
		if not data then return nil end
		local valueObj = data:FindFirstChild(valueName)
		if not valueObj then return nil end
		return valueObj.Value
	end)
	if success and result ~= nil then
		return result
	end
	return nil
end

local function getLeaderstats(targetPlayer, statName)
	if not targetPlayer then return nil end
	local success, result = pcall(function()
		local stats = targetPlayer:FindFirstChild("leaderstats")
		if not stats then return nil end
		local statObj = stats:FindFirstChild(statName)
		if not statObj then return nil end
		return statObj.Value
	end)
	if success and result ~= nil then
		return result
	end
	return nil
end

--------------------------------------------------
-- Core scan logic
--------------------------------------------------

local function scanAttributesEverywhere()
	print("\n\n================== EXPOSURE GLOBAL SCAN START ==================")

	--------------------------
	-- 1) Attributes: any instance with Attribute "Exposure"
	--------------------------

	local function checkAttributesOn(inst)
		local attrs
		local ok = pcall(function()
			attrs = inst:GetAttributes()
		end)
		if ok and attrs and attrs["Exposure"] ~= nil then
			warn(("[ATTR] %s  ->  Attribute 'Exposure' = %s")
				:format(inst:GetFullName(), tostring(attrs["Exposure"])))
		end
	end

	print(">> Scanning all Attributes for 'Exposure'...")
	checkAttributesOn(game)
	for _, inst in ipairs(game:GetDescendants()) do
		checkAttributesOn(inst)
	end

	--------------------------
	-- 2) Any ValueBase named "Exposure" anywhere in game
	--------------------------

	print(">> Scanning all ValueBase objects named 'Exposure'...")
	for _, inst in ipairs(game:GetDescendants()) do
		if inst.Name == "Exposure" and inst:IsA("ValueBase") then
			local val
			local ok = pcall(function()
				val = inst.Value
			end)
			warn(("[VALUE] %s  ->  %s (%s) = %s")
				:format(inst:GetFullName(), inst.Name, inst.ClassName, tostring(ok and val or "<?>")))
		end
	end

	--------------------------
	-- 3) Per-player: use your helper patterns
	--------------------------

	print(">> Checking all players using getCharAttr / getPlayerAttr / getDataValue / getLeaderstats...")

	for _, plr in ipairs(Players:GetPlayers()) do
		local char = plr.Character
		print(("--- Player: %s ---"):format(plr.Name))

		local fromCharAttr = getCharAttr(char, "Exposure")
		if fromCharAttr ~= nil and char then
			warn(("[PLAYER CHAR ATTR] %s  ->  Character attribute 'Exposure' = %s")
				:format(char:GetFullName(), tostring(fromCharAttr)))
		end

		local fromPlayerAttr = getPlayerAttr(plr, "Exposure")
		if fromPlayerAttr ~= nil then
			warn(("[PLAYER ATTR] %s  ->  Player attribute 'Exposure' = %s")
				:format(plr:GetFullName(), tostring(fromPlayerAttr)))
		end

		local fromData = getDataValue(plr, "Exposure")
		if fromData ~= nil then
			-- We don't know exact child path from helper, so search it:
			local dataFolder = plr:FindFirstChild("Data")
			if dataFolder then
				for _, obj in ipairs(dataFolder:GetDescendants()) do
					if obj.Name == "Exposure" and obj:IsA("ValueBase") then
						warn(("[PLAYER DATA] %s  ->  Value 'Exposure' = %s")
							:format(obj:GetFullName(), tostring(fromData)))
					end
				end
			else
				warn(("[PLAYER DATA] %s  ->  Exposure found via getDataValue, but Data folder path unknown")
					:format(plr.Name))
			end
		end

		local fromLeader = getLeaderstats(plr, "Exposure")
		if fromLeader ~= nil then
			local ls = plr:FindFirstChild("leaderstats")
			if ls then
				for _, obj in ipairs(ls:GetDescendants()) do
					if obj.Name == "Exposure" and obj:IsA("ValueBase") then
						warn(("[PLAYER LEADERSTATS] %s  ->  Value 'Exposure' = %s")
							:format(obj:GetFullName(), tostring(fromLeader)))
					end
				end
			else
				warn(("[PLAYER LEADERSTATS] %s  ->  Exposure found via getLeaderstats, but leaderstats path unknown")
					:format(plr.Name))
			end
		end
	end

	print("=================== EXPOSURE GLOBAL SCAN END ===================\n")
end

--------------------------------------------------
-- Run scan automatically + keybind
--------------------------------------------------

-- Initial scan after a short delay so the world can load a bit
task.delay(1, function()
	scanAttributesEverywhere()
end)

-- Rescan on key press (L)
UserInputService.InputBegan:Connect(function(input, gpe)
	if gpe then return end
	if input.KeyCode == Enum.KeyCode.L then
		scanAttributesEverywhere()
	end
end)
