-- stepby.lua - Local-sided UI inspired by the provided Gamesense panel
-- Place this file in a LocalScript (e.g., StarterPlayerScripts) to run on the client

-- Wait for game
if not game:IsLoaded() then game.Loaded:Wait() end

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local localPlayer = Players.LocalPlayer
local playerGui = localPlayer:WaitForChild("PlayerGui")

-- Remove previous instances if re-run
local existing = playerGui:FindFirstChild("StepByUI")
if existing then existing:Destroy() end

-- THEME
local theme = {
	bg = Color3.fromRGB(18, 19, 22),
	panel = Color3.fromRGB(26, 27, 31),
	subtle = Color3.fromRGB(34, 36, 42),
	stroke = Color3.fromRGB(48, 50, 58),
	accent = Color3.fromRGB(92, 214, 103),
	accentDim = Color3.fromRGB(62, 160, 78),
	text = Color3.fromRGB(235, 235, 245),
	muted = Color3.fromRGB(160, 164, 175),
	shadow = Color3.fromRGB(0, 0, 0),
	red = Color3.fromRGB(255, 95, 95),
}

-- UTIL
local function round(gui, r)
	local c = Instance.new("UICorner")
	c.CornerRadius = UDim.new(0, r or 6)
	c.Parent = gui
	return c
end

local function stroke(gui, color, thickness)
	local s = Instance.new("UIStroke")
	s.Thickness = thickness or 1
	s.Color = color or theme.stroke
	s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	s.Parent = gui
	return s
end

local function pad(gui, l, t, r, b)
	local p = Instance.new("UIPadding")
	p.PaddingLeft = UDim.new(0, l or 0)
	p.PaddingTop = UDim.new(0, t or 0)
	p.PaddingRight = UDim.new(0, r or 0)
	p.PaddingBottom = UDim.new(0, b or 0)
	p.Parent = gui
	return p
end

local function vlist(parent, padding)
	local list = Instance.new("UIListLayout")
	list.FillDirection = Enum.FillDirection.Vertical
	list.HorizontalAlignment = Enum.HorizontalAlignment.Left
	list.VerticalAlignment = Enum.VerticalAlignment.Top
	list.Padding = UDim.new(0, padding or 8)
	list.SortOrder = Enum.SortOrder.LayoutOrder
	list.Parent = parent
	return list
end

local function hlist(parent, padding)
	local list = Instance.new("UIListLayout")
	list.FillDirection = Enum.FillDirection.Horizontal
	list.HorizontalAlignment = Enum.HorizontalAlignment.Left
	list.VerticalAlignment = Enum.VerticalAlignment.Center
	list.Padding = UDim.new(0, padding or 8)
	list.SortOrder = Enum.SortOrder.LayoutOrder
	list.Parent = parent
	return list
end

local function makeText(parent, text, size, color, bold)
	local lbl = Instance.new("TextLabel")
	lbl.BackgroundTransparency = 1
	lbl.Font = Enum.Font.Gotham
	lbl.Text = text or ""
	lbl.TextXAlignment = Enum.TextXAlignment.Left
	lbl.TextYAlignment = Enum.TextYAlignment.Center
	lbl.TextSize = size or 14
	lbl.TextColor3 = color or theme.text
	lbl.RichText = true
	lbl.Parent = parent
	lbl.AutoLocalize = false
	if bold then lbl.FontFace.Weight = Enum.FontWeight.Bold end
	return lbl
end

local function tween(o, tinfo, props)
	TweenService:Create(o, tinfo or TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props):Play()
end

-- DRAGGING
local function makeDraggable(dragHandle, target)
	local dragging = false
	local dragStart, startPos

	dragHandle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = target.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			local delta = input.Position - dragStart
			target.Position = UDim2.fromOffset(startPos.X.Offset + delta.X, startPos.Y.Offset + delta.Y)
		end
	end)
end

-- ROOT GUI
local ui = Instance.new("ScreenGui")
ui.Name = "StepByUI"
ui.ResetOnSpawn = false
ui.ZIndexBehavior = Enum.ZIndexBehavior.Global
ui.Parent = playerGui

-- MAIN WINDOW
local main = Instance.new("Frame")
main.Name = "Main"
main.Size = UDim2.fromOffset(980, 570)
main.Position = UDim2.fromScale(0.5, 0.5)
main.AnchorPoint = Vector2.new(0.5, 0.5)
main.BackgroundColor3 = theme.panel
main.BorderSizePixel = 0
main.Parent = ui
round(main, 10)
stroke(main, theme.subtle, 1)

-- TOP BAR
local top = Instance.new("Frame")
top.Name = "TopBar"
top.Size = UDim2.new(1, 0, 0, 44)
top.BackgroundColor3 = theme.bg
top.BorderSizePixel = 0
round(top, 10)
-- mask round only top by overlaying a separate cornered frame
local topMask = Instance.new("UICorner")
topMask.CornerRadius = UDim.new(0, 10)
topMask.Parent = top

top.Parent = main
stroke(top, theme.subtle, 1)

local title = makeText(top, "GAMESENSE", 18, theme.text, true)
title.Size = UDim2.fromOffset(200, 44)
title.Position = UDim2.fromOffset(16, 0)

local saveBtn = Instance.new("TextButton")
saveBtn.Name = "Save"
saveBtn.Text = "Save"
saveBtn.Font = Enum.Font.Gotham
saveBtn.TextSize = 14
saveBtn.TextColor3 = theme.text
saveBtn.AutoButtonColor = false
saveBtn.Size = UDim2.fromOffset(72, 28)
saveBtn.Position = UDim2.new(1, -88, 0, 8)
saveBtn.BackgroundColor3 = theme.subtle
saveBtn.Parent = top
round(saveBtn, 6)
stroke(saveBtn, theme.stroke, 1)

local function buttonHover(btn)
	btn.MouseEnter:Connect(function() tween(btn, nil, {BackgroundColor3 = theme.stroke}) end)
	btn.MouseLeave:Connect(function() tween(btn, nil, {BackgroundColor3 = theme.subtle}) end)
end
buttonHover(saveBtn)

makeDraggable(top, main)

-- BODY
local body = Instance.new("Frame")
body.Name = "Body"
body.BackgroundColor3 = theme.panel
body.BorderSizePixel = 0
body.Position = UDim2.fromOffset(0, 44)
body.Size = UDim2.new(1, 0, 1, -44)
body.Parent = main

-- SIDEBAR
local sidebar = Instance.new("Frame")
sidebar.Name = "Sidebar"
sidebar.BackgroundColor3 = theme.bg
sidebar.BorderSizePixel = 0
sidebar.Size = UDim2.fromOffset(190, body.Size.Y.Offset)
sidebar.Position = UDim2.fromOffset(0, 0)
sidebar.Parent = body
stroke(sidebar, theme.subtle, 1)

local sidebarList = Instance.new("ScrollingFrame")
sidebarList.Name = "List"
sidebarList.Size = UDim2.new(1, 0, 1, -16)
sidebarList.Position = UDim2.fromOffset(0, 8)
sidebarList.BackgroundTransparency = 1
sidebarList.BorderSizePixel = 0
sidebarList.ScrollBarThickness = 3
sidebarList.ScrollBarImageColor3 = theme.stroke
sidebarList.Parent = sidebar
pad(sidebarList, 12, 8, 12, 8)

vlist(sidebarList, 6)

local function sideButton(text, active)
	local btn = Instance.new("TextButton")
	btn.Text = text
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	btn.TextXAlignment = Enum.TextXAlignment.Left
	btn.AutoButtonColor = false
	btn.Size = UDim2.new(1, 0, 0, 32)
	btn.BackgroundColor3 = active and theme.subtle or theme.bg
	btn.TextColor3 = active and theme.text or theme.muted
	round(btn, 6)
	stroke(btn, theme.stroke, 1)
	btn.Parent = sidebarList
	btn.MouseEnter:Connect(function()
		if btn.BackgroundColor3 ~= theme.subtle then tween(btn, nil, {BackgroundColor3 = theme.panel}) end
	end)
	btn.MouseLeave:Connect(function()
		if btn.BackgroundColor3 ~= theme.subtle then tween(btn, nil, {BackgroundColor3 = theme.bg}) end
	end)
	return btn
end

local cats = {
	"RageBot", "Anti Aim", "Legitbot",
	"Players", "Weapon", "Grenades", "Bomb",
	"World", "View", "Miscellaneous", "Main", "Inventory", "Lua", "Configs"
}

for i, c in ipairs(cats) do
	sideButton(c, c == "Anti Aim").LayoutOrder = i
end

-- CONTENT AREA
local content = Instance.new("Frame")
content.Name = "Content"
content.BackgroundColor3 = theme.panel
content.BorderSizePixel = 0
content.Position = UDim2.fromOffset(190, 0)
content.Size = UDim2.new(1, -190, 1, 0)
content.Parent = body

-- Two-column layout
local contentPad = pad(content, 16, 16, 16, 16)
local columns = Instance.new("UIGridLayout")
columns.CellPadding = UDim2.fromOffset(16, 16)
columns.CellSize = UDim2.new(0.5, -8, 1, 0) -- two columns
columns.FillDirectionMaxCells = 2
columns.SortOrder = Enum.SortOrder.LayoutOrder
columns.HorizontalAlignment = Enum.HorizontalAlignment.Left
columns.VerticalAlignment = Enum.VerticalAlignment.Top
columns.Parent = content

-- GroupBox factory
local function groupBox(titleText)
	local box = Instance.new("Frame")
	box.Name = titleText:gsub(" ","") .. "Box"
	box.BackgroundColor3 = theme.bg
	box.BorderSizePixel = 0
	box.Size = UDim2.new(0, 0, 1, 0) -- grid will size it
	box.Parent = content
	round(box, 8)
	stroke(box, theme.subtle, 1)

	local header = Instance.new("Frame")
	header.Name = "Header"
	header.BackgroundTransparency = 1
	header.Size = UDim2.new(1, -16, 0, 34)
	header.Position = UDim2.fromOffset(8, 6)
	header.Parent = box

	local hLabel = makeText(header, titleText, 16, theme.text, true)
	hLabel.Size = UDim2.new(1, 0, 1, 0)

	local sep = Instance.new("Frame")
	sep.BackgroundColor3 = theme.subtle
	sep.BorderSizePixel = 0
	sep.Size = UDim2.new(1, -16, 0, 1)
	sep.Position = UDim2.fromOffset(8, 40)
	sep.Parent = box

	local area = Instance.new("Frame")
	area.Name = "Area"
	area.BackgroundTransparency = 1
	area.Position = UDim2.fromOffset(8, 48)
	area.Size = UDim2.new(1, -16, 1, -56)
	area.Parent = box

	local scroll = Instance.new("ScrollingFrame")
	scroll.Name = "Scroll"
	scroll.BackgroundTransparency = 1
	scroll.Size = UDim2.fromScale(1, 1)
	scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
	scroll.ScrollBarThickness = 3
	scroll.ScrollBarImageColor3 = theme.stroke
	scroll.Parent = area
	pad(scroll, 4, 4, 4, 4)

	local layout = vlist(scroll, 10)
	layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		scroll.CanvasSize = UDim2.fromOffset(0, layout.AbsoluteContentSize.Y + 8)
	end)

	return box, scroll
end

-- Controls factories
local State = {}

local function rowContainer(parent)
	local r = Instance.new("Frame")
	r.BackgroundTransparency = 1
	r.Size = UDim2.new(1, 0, 0, 32)
	r.Parent = parent
	hlist(r, 8)
	return r
end

local function Toggle(parent, label, key, default, callback)
	local row = rowContainer(parent)
	row.Size = UDim2.new(1, 0, 0, 30)
	local tLabel = makeText(row, label, 14, theme.muted, false)
	tLabel.Size = UDim2.new(1, -60, 1, 0)

	local btn = Instance.new("TextButton")
	btn.Text = ""
	btn.AutoButtonColor = false
	btn.Size = UDim2.fromOffset(46, 24)
	btn.BackgroundColor3 = theme.subtle
	btn.Parent = row
	round(btn, 12)
	stroke(btn, theme.stroke, 1)

	local knob = Instance.new("Frame")
	knob.Size = UDim2.fromOffset(20, 20)
	knob.Position = UDim2.fromOffset(2, 2)
	knob.BackgroundColor3 = theme.muted
	knob.Parent = btn
	round(knob, 10)

	local on = default or false
	State[key] = on

	local function render()
		if on then
			btn.BackgroundColor3 = theme.accent
			knob.Position = UDim2.fromOffset(24, 2)
			knob.BackgroundColor3 = Color3.fromRGB(255,255,255)
		else
			btn.BackgroundColor3 = theme.subtle
			knob.Position = UDim2.fromOffset(2, 2)
			knob.BackgroundColor3 = theme.muted
		end
	end

	btn.MouseButton1Click:Connect(function()
		on = not on
		State[key] = on
		render()
		if callback then callback(on) end
	end)

	render()
	return setmetatable({}, {__index = {Set = function(_, v) on=v State[key]=v render() end}})
end

local function Slider(parent, label, key, min, max, default, step, callback)
	local row = rowContainer(parent)
	row.Size = UDim2.new(1, 0, 0, 46)
	local tLabel = makeText(row, label, 14, theme.muted, false)
	tLabel.Size = UDim2.new(1, 0, 0, 16)
	tLabel.LayoutOrder = 1

	local container = Instance.new("Frame")
	container.Size = UDim2.new(1, 0, 0, 24)
	container.BackgroundColor3 = theme.subtle
	container.Parent = row
	round(container, 6)
	stroke(container, theme.stroke, 1)

	local fill = Instance.new("Frame")
	fill.Size = UDim2.fromScale(0, 1)
	fill.BackgroundColor3 = theme.accent
	fill.BorderSizePixel = 0
	fill.Parent = container
	round(fill, 6)

	local drag = Instance.new("Frame")
	drag.BackgroundTransparency = 1
	drag.Size = UDim2.fromScale(1, 1)
	drag.Parent = container

	local valText = makeText(container, "", 12, theme.text, false)
	valText.Size = UDim2.new(1, -8, 1, 0)
	valText.Position = UDim2.fromOffset(8, 0)
	valText.TextXAlignment = Enum.TextXAlignment.Right

	min = min or 0; max = max or 100
	step = step or 1
	local value = math.clamp(default or min, min, max)
	State[key] = value

	local function percentFromValue(v)
		return (v - min) / (max - min)
	end

	local function valueFromX(x)
		local abs = container.AbsoluteSize.X
		local p = math.clamp(x / abs, 0, 1)
		local raw = min + (max - min) * p
		local snapped = math.floor((raw + step/2) / step) * step
		return math.clamp(snapped, min, max)
	end

	local function render()
		fill.Size = UDim2.fromScale(percentFromValue(value), 1)
		valText.Text = string.format("%s", tostring(value))
	end

	local sliding = false
	drag.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			sliding = true
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				value = valueFromX((UIS:GetMouseLocation() - Vector2.new(container.AbsolutePosition.X, 0)).X)
				State[key] = value
				render()
				if callback then callback(value) end
			end
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then sliding = false end
			end)
		end
	end)

	UIS.InputChanged:Connect(function(input)
		if sliding and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			value = valueFromX((UIS:GetMouseLocation() - Vector2.new(container.AbsolutePosition.X, 0)).X)
			State[key] = value
			render()
			if callback then callback(value) end
		end
	end)

	render()
	return setmetatable({}, {__index = {Set = function(_, v) value=math.clamp(v,min,max) State[key]=value render() end}})
end

local function Dropdown(parent, label, key, items, default, callback)
	items = items or {"Off"}
	local row = rowContainer(parent)
	row.Size = UDim2.new(1, 0, 0, 64)

	local tLabel = makeText(row, label, 14, theme.muted, false)
	tLabel.Size = UDim2.new(1, 0, 0, 16)

	local box = Instance.new("TextButton")
	box.Text = ""
	box.AutoButtonColor = false
	box.Size = UDim2.new(1, 0, 0, 28)
	box.BackgroundColor3 = theme.subtle
	box.Parent = row
	round(box, 6)
	stroke(box, theme.stroke, 1)

	local current = makeText(box, default or items[1], 14, theme.text, false)
	current.Size = UDim2.new(1, -32, 1, 0)
	current.Position = UDim2.fromOffset(8, 0)

	local caret = makeText(box, "â–¼", 14, theme.muted, false)
	caret.Size = UDim2.fromOffset(24, 28)
	caret.Position = UDim2.new(1, -24, 0, 0)
	caret.TextXAlignment = Enum.TextXAlignment.Center

	local list = Instance.new("Frame")
	list.Visible = false
	list.BackgroundColor3 = theme.subtle
	list.BorderSizePixel = 0
	list.Size = UDim2.new(1, 0, 0, 28 * math.min(#items, 6))
	list.Position = UDim2.fromOffset(0, 30)
	list.Parent = row
	round(list, 6)
	stroke(list, theme.stroke, 1)
	pad(list, 4, 4, 4, 4)
	local l = vlist(list, 4)

	local value = default or items[1]
	State[key] = value

	local function setValue(v)
		value = v
		State[key] = v
		current.Text = v
		if callback then callback(v) end
	end

	for i, it in ipairs(items) do
		local opt = Instance.new("TextButton")
		opt.Text = it
		opt.Font = Enum.Font.Gotham
		opt.TextSize = 14
		opt.TextColor3 = theme.text
		opt.AutoButtonColor = false
		opt.BackgroundColor3 = theme.bg
		opt.Size = UDim2.new(1, 0, 0, 24)
		opt.Parent = list
		round(opt, 4)
		stroke(opt, theme.stroke, 1)
		opt.MouseEnter:Connect(function() tween(opt, nil, {BackgroundColor3 = theme.panel}) end)
		opt.MouseLeave:Connect(function() tween(opt, nil, {BackgroundColor3 = theme.bg}) end)
		opt.MouseButton1Click:Connect(function()
			setValue(it)
			list.Visible = false
		end)
	end

	box.MouseButton1Click:Connect(function()
		list.Visible = not list.Visible
	end)

	return setmetatable({}, {__index = {Set = function(_, v) setValue(v) end}})
end

-- GROUPS
local leftBox, leftScroll = groupBox("Anti-aimbot angles")
leftBox.LayoutOrder = 1
local rightBox, rightScroll = groupBox("Fake lag")
rightBox.LayoutOrder = 2

-- LEFT: Anti-aimbot angles
Toggle(leftScroll, "Enabled", "aa_enabled", true)
Dropdown(leftScroll, "Pitch", "aa_pitch", {"Off","Down","Up","Zero"}, "Off")
Dropdown(leftScroll, "Yaw base", "aa_yaw_base", {"Local view","At targets","Manual"}, "Local view")
Slider(leftScroll, "Yaw", "aa_yaw", -180, 180, 0, 1)
Dropdown(leftScroll, "Yaw jitter", "aa_yaw_jitter", {"Off","Center","Random","Offset"}, "Off")
Slider(leftScroll, "Body yaw", "aa_body_yaw", 0, 180, 0, 1)
Dropdown(leftScroll, "Freestanding body yaw", "aa_fs_body_yaw", {"Off","Default","Jitter"}, "Off")
Slider(leftScroll, "Edge yaw", "aa_edge_yaw", 0, 180, 0, 1)
Dropdown(leftScroll, "Freestanding", "aa_freestanding", {"Off","On","Peek only","Always"}, "Off")

-- RIGHT: Fake lag
Toggle(rightScroll, "Enabled", "fl_enabled", true)
Dropdown(rightScroll, "Amount", "fl_amount", {"Static","Adaptive","Dynamic"}, "Dynamic")
Slider(rightScroll, "Variance", "fl_variance", 0, 100, 0, 1)
Slider(rightScroll, "Limit", "fl_limit", 0, 16, 8, 1)

local otherSep = makeText(rightScroll, "Other", 14, theme.muted, true)
otherSep.Size = UDim2.new(1, 0, 0, 18)

Dropdown(rightScroll, "Slow motion type", "slowmo_type", {"Favor high speed","Favor distance","Balanced"}, "Favor high speed")
Dropdown(rightScroll, "Leg movement", "leg_movement", {"Off","Always slide","While moving","While airborne"}, "Off")
Toggle(rightScroll, "On shot anti-aim", "on_shot_aa", false)
Toggle(rightScroll, "Fake peek", "fake_peek", false)

-- SAVE BUTTON ACTION
saveBtn.MouseButton1Click:Connect(function()
	-- Simple print-out of current state; replace with datastore/serialization if needed
	local json
	pcall(function()
		json = game:GetService("HttpService"):JSONEncode(State)
	end)
	if json then
		print("[StepByUI] Saved state:", json)
	else
		print("[StepByUI] Current state:")
		for k, v in pairs(State) do
			print("  ", k, v)
		end
	end
	-- Flash feedback
	saveBtn.Text = "Saved"
	tween(saveBtn, TweenInfo.new(0.2), {BackgroundColor3 = theme.accent})
	task.delay(0.6, function()
		tween(saveBtn, TweenInfo.new(0.2), {BackgroundColor3 = theme.subtle})
		saveBtn.Text = "Save"
	end)
end)

-- ESC to toggle visibility
local open = true
UIS.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.RightControl or input.KeyCode == Enum.KeyCode.F1 then
		open = not open
		main.Visible = open
	end
end)

print("[StepByUI] UI loaded (RightControl or F1 to toggle)")
