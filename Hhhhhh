--!strict
-- ZETA LABS // BIO-SCANNER (polished UI)
-- Keeps your original behavior; adds visual polish + small safety/UX fixes.

--/// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")

local player = Players.LocalPlayer

--/// Theme + constants
local PALETTE = {
	bg         = Color3.fromRGB(24, 26, 28),
	surface    = Color3.fromRGB(30, 33, 36),
	surface2   = Color3.fromRGB(36, 40, 44),
	text       = Color3.fromRGB(230, 240, 240),
	textSubtle = Color3.fromRGB(160, 180, 185),
	stroke     = Color3.fromRGB(255, 255, 255), -- used with high transparency
	accent     = Color3.fromRGB(62, 140, 140),
	accentHi   = Color3.fromRGB(90, 190, 190),
	danger     = Color3.fromRGB(210, 70, 70),
	success    = Color3.fromRGB(0, 200, 120),
}
local RADIUS = 12
local MIN_W, MIN_H, MAX_W, MAX_H = 280, 260, 900, 800

-- Optional shadow 9-slice; set to your asset id or leave nil to skip
local SHADOW_ASSET_ID: string? = nil -- e.g., "rbxassetid://11747206963"

--/// GUI Root
local gui = Instance.new("ScreenGui")
gui.Name = "Zeta Labs"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Main frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 400, 0, 450)
frame.Position = UDim2.new(0.5, -200, 0.5, -225)
frame.BackgroundColor3 = PALETTE.surface
frame.BorderSizePixel = 0
frame.Parent = gui
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, RADIUS)

-- Hairline stroke + gradient
do
	local stroke = Instance.new("UIStroke")
	stroke.Thickness = 1
	stroke.Color = PALETTE.stroke
	stroke.Transparency = 0.9
	stroke.Parent = frame

	local grad = Instance.new("UIGradient")
	grad.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.fromRGB(36,40,44)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(30,33,36)),
	})
	grad.Rotation = 90
	grad.Parent = frame

	if SHADOW_ASSET_ID then
		local shadow = Instance.new("ImageLabel")
		shadow.Name = "DropShadow"
		shadow.BackgroundTransparency = 1
		shadow.Image = SHADOW_ASSET_ID
		shadow.ScaleType = Enum.ScaleType.Slice
		shadow.SliceCenter = Rect.new(20,20,280,280)
		shadow.ImageTransparency = 0.45
		shadow.Size = UDim2.new(1, 24, 1, 24)
		shadow.Position = UDim2.new(0, -12, 0, -12)
		shadow.ZIndex = 0
		shadow.Parent = frame
	end
end

-- Title bar
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 36)
titleBar.BackgroundColor3 = PALETTE.surface2
titleBar.BorderSizePixel = 0
titleBar.Parent = frame
Instance.new("UICorner", titleBar).CornerRadius = UDim.new(0, RADIUS)

local underline = Instance.new("Frame")
underline.Size = UDim2.new(1, 0, 0, 2)
underline.Position = UDim2.new(0, 0, 1, -2)
underline.BackgroundColor3 = PALETTE.accent
underline.BorderSizePixel = 0
underline.Parent = titleBar

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -46, 1, 0)
title.Position = UDim2.new(0, 12, 0, 0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextSize = 20
title.Text = "ZETA LABS // BIO-SCANNER"
title.TextColor3 = PALETTE.text
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = titleBar

-- Close Button
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -34, 0, 3)
closeBtn.Text = "âœ•"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 18
closeBtn.TextColor3 = Color3.fromRGB(255, 140, 140)
closeBtn.BackgroundTransparency = 1
closeBtn.Parent = titleBar

-- Uninject Button
local uninjectBtn = Instance.new("TextButton")
uninjectBtn.Size = UDim2.new(0, 30, 0, 30)
uninjectBtn.Position = UDim2.new(1, -68, 0, 3)
uninjectBtn.Text = "ðŸ—‘"
uninjectBtn.Font = Enum.Font.GothamBold
uninjectBtn.TextSize = 16
uninjectBtn.TextColor3 = Color3.fromRGB(255, 100, 100)
uninjectBtn.BackgroundTransparency = 1
uninjectBtn.Parent = titleBar

closeBtn.MouseButton1Click:Connect(function() gui.Enabled = false end)

-- Resize handle (bottom-right corner)
local resizeHandle = Instance.new("TextButton")
resizeHandle.Size = UDim2.new(0, 20, 0, 20)
resizeHandle.Position = UDim2.new(1, -24, 1, -24)
resizeHandle.Text = "â‹°"
resizeHandle.Font = Enum.Font.GothamBold
resizeHandle.TextSize = 16
resizeHandle.TextColor3 = PALETTE.textSubtle
resizeHandle.BackgroundTransparency = 1
resizeHandle.ZIndex = 5
resizeHandle.Parent = frame

-- Confirmation Modal + dimmer + blur
local dim = Instance.new("Frame")
dim.BackgroundColor3 = Color3.new(0,0,0)
dim.BackgroundTransparency = 0.6
dim.Visible = false
dim.ZIndex = 19
dim.Size = UDim2.fromScale(1,1)
dim.Parent = gui

local blur = Instance.new("BlurEffect")
blur.Size = 0
blur.Enabled = false
blur.Parent = Lighting

local confirmDialog = Instance.new("Frame")
confirmDialog.Size = UDim2.new(0, 300, 0, 120)
confirmDialog.Position = UDim2.new(0.5, -150, 0.5, -60)
confirmDialog.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
confirmDialog.BorderSizePixel = 0
confirmDialog.Visible = false
confirmDialog.ZIndex = 20
confirmDialog.Parent = gui
Instance.new("UICorner", confirmDialog).CornerRadius = UDim.new(0, RADIUS-2)

do
	local s = Instance.new("UIStroke")
	s.Thickness, s.Color, s.Transparency = 1, PALETTE.stroke, 0.8
	s.Parent = confirmDialog

	local confirmTitle = Instance.new("TextLabel")
	confirmTitle.Size = UDim2.new(1, -20, 0, 30)
	confirmTitle.Position = UDim2.new(0, 10, 0, 10)
	confirmTitle.BackgroundTransparency = 1
	confirmTitle.Font = Enum.Font.GothamBold
	confirmTitle.TextSize = 16
	confirmTitle.Text = "âš  CONFIRM UNINJECT"
	confirmTitle.TextColor3 = Color3.fromRGB(255, 200, 100)
	confirmTitle.ZIndex = 21
	confirmTitle.Parent = confirmDialog

	local confirmMessage = Instance.new("TextLabel")
	confirmMessage.Size = UDim2.new(1, -20, 0, 36)
	confirmMessage.Position = UDim2.new(0, 10, 0, 44)
	confirmMessage.BackgroundTransparency = 1
	confirmMessage.Font = Enum.Font.Gotham
	confirmMessage.TextSize = 13
	confirmMessage.Text = "Are you sure you want to do this?\nThis will close the menu permanently."
	confirmMessage.TextColor3 = PALETTE.text
	confirmMessage.TextWrapped = true
	confirmMessage.ZIndex = 21
	confirmMessage.Parent = confirmDialog

	local confirmYesBtn = Instance.new("TextButton")
	confirmYesBtn.Size = UDim2.new(0, 130, 0, 32)
	confirmYesBtn.Position = UDim2.new(0, 10, 1, -42)
	confirmYesBtn.Text = "YES, UNINJECT"
	confirmYesBtn.Font = Enum.Font.GothamBold
	confirmYesBtn.TextSize = 13
	confirmYesBtn.TextColor3 = PALETTE.text
	confirmYesBtn.BackgroundColor3 = PALETTE.danger
	confirmYesBtn.BorderSizePixel = 0
	confirmYesBtn.ZIndex = 21
	confirmYesBtn.Parent = confirmDialog
	Instance.new("UICorner", confirmYesBtn).CornerRadius = UDim.new(0, RADIUS-6)

	local confirmNoBtn = Instance.new("TextButton")
	confirmNoBtn.Size = UDim2.new(0, 130, 0, 32)
	confirmNoBtn.Position = UDim2.new(1, -140, 1, -42)
	confirmNoBtn.Text = "CANCEL"
	confirmNoBtn.Font = Enum.Font.GothamBold
	confirmNoBtn.TextSize = 13
	confirmNoBtn.TextColor3 = PALETTE.text
	confirmNoBtn.BackgroundColor3 = PALETTE.surface2
	confirmNoBtn.BorderSizePixel = 0
	confirmNoBtn.ZIndex = 21
	confirmNoBtn.Parent = confirmDialog
	Instance.new("UICorner", confirmNoBtn).CornerRadius = UDim.new(0, RADIUS-6)

	local function showConfirmModal(show: boolean)
		dim.Visible = show
		confirmDialog.Visible = show
		blur.Enabled = show
		TweenService:Create(blur, TweenInfo.new(0.15), {Size = show and 8 or 0}):Play()
		if show then
			confirmDialog.Size = UDim2.new(0, 280, 0, 0)
			TweenService:Create(confirmDialog, TweenInfo.new(0.16, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
				{Size = UDim2.new(0, 300, 0, 120)}):Play()
		end
	end

	uninjectBtn.MouseButton1Click:Connect(function() showConfirmModal(true) end)
	confirmNoBtn.MouseButton1Click:Connect(function() showConfirmModal(false) end)
	confirmYesBtn.MouseButton1Click:Connect(function()
		showConfirmModal(false)
		gui:Destroy()
	end)

	-- Esc to cancel modal
	UserInputService.InputBegan:Connect(function(input, gpe)
		if gpe then return end
		if confirmDialog.Visible and input.KeyCode == Enum.KeyCode.Escape then
			showConfirmModal(false)
		end
	end)
end

-- Content padding under title bar
local contentMargin = Instance.new("Frame")
contentMargin.BackgroundTransparency = 1
contentMargin.Size = UDim2.new(1,-20,1,-48)
contentMargin.Position = UDim2.new(0,10,0,42)
contentMargin.Parent = frame

-- Target Box
local box = Instance.new("TextBox")
box.Size = UDim2.new(1, 0, 0, 32)
box.Position = UDim2.new(0, 0, 0, 0)
box.PlaceholderText = "Enter player name (leave empty for self)"
box.BackgroundColor3 = PALETTE.surface2
box.TextColor3 = PALETTE.text
box.Font = Enum.Font.Gotham
box.TextSize = 16
box.ClearTextOnFocus = false
box.Parent = contentMargin
Instance.new("UICorner", box).CornerRadius = UDim.new(0, RADIUS-4)
do
	local s = Instance.new("UIStroke")
	s.Thickness, s.Color, s.Transparency = 1, PALETTE.stroke, 0.85
	s.Parent = box
end

-- Dropdown for player list
local dropdown = Instance.new("ScrollingFrame")
dropdown.Size = UDim2.new(1, 0, 0.28, 0)
dropdown.Position = UDim2.new(0, 0, 0, 36)
dropdown.BackgroundColor3 = PALETTE.surface2
dropdown.BorderSizePixel = 0
dropdown.Visible = false
dropdown.ScrollBarThickness = 6
dropdown.CanvasSize = UDim2.new(0, 0, 0, 0)
dropdown.ZIndex = 10
dropdown.Parent = contentMargin
Instance.new("UICorner", dropdown).CornerRadius = UDim.new(0, RADIUS-4)
do
	local s = Instance.new("UIStroke")
	s.Thickness, s.Color, s.Transparency = 1, PALETTE.stroke, 0.88
	s.Parent = dropdown
end

local dropdownList = Instance.new("UIListLayout")
dropdownList.Parent = dropdown
dropdownList.Padding = UDim.new(0, 2)

-- Tab Buttons Container
local tabContainer = Instance.new("Frame")
tabContainer.Size = UDim2.new(1, 0, 0, 32)
tabContainer.Position = UDim2.new(0, 0, 0, dropdown.Size.Y.Offset + 40) -- below dropdown area
tabContainer.BackgroundTransparency = 1
tabContainer.Parent = contentMargin

local function makeTabButton(text: string, position: number)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.48, 0, 1, 0)
	btn.Position = UDim2.new(position, 0, 0, 0)
	btn.Text = text
	btn.Font = Enum.Font.GothamBold
	btn.TextSize = 14
	btn.BackgroundColor3 = PALETTE.surface2
	btn.TextColor3 = PALETTE.textSubtle
	btn.BorderSizePixel = 0
	btn.AutoButtonColor = false
	btn.Parent = tabContainer
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, RADIUS-4)
	local s = Instance.new("UIStroke", btn)
	s.Thickness, s.Color, s.Transparency = 1, PALETTE.stroke, 0.88
	btn.MouseEnter:Connect(function()
		TweenService:Create(btn, TweenInfo.new(0.1), {BackgroundColor3 = PALETTE.accentHi}):Play()
	end)
	btn.MouseLeave:Connect(function()
		TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = PALETTE.surface2}):Play()
	end)
	return btn
end

-- forward-declare to avoid nil in handlers
local tab1Btn, tab2Btn
tab1Btn = makeTabButton("BIO DATA", 0)
tab2Btn = makeTabButton("STATS", 0.52)

-- Content Container
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, 0, 1, -(36 + 32 + 16 + 42)) -- fill remaining area
contentFrame.Position = UDim2.new(0, 0, 0, 36 + 32 + 16 + 42)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = contentMargin

-- Tab frames
local tab1Content = Instance.new("Frame")
tab1Content.Size = UDim2.new(1, 0, 1, 0)
tab1Content.BackgroundTransparency = 1
tab1Content.Visible = true
tab1Content.Parent = contentFrame

local tab2Content = Instance.new("Frame")
tab2Content.Size = UDim2.new(1, 0, 1, 0)
tab2Content.BackgroundTransparency = 1
tab2Content.Visible = false
tab2Content.Parent = contentFrame

-- Helper: smooth bar styling
local function styleBar(bg: Frame, fill: Frame, fromCol: Color3, toCol: Color3)
	bg.BackgroundColor3 = PALETTE.surface2
	bg.BorderSizePixel = 0
	Instance.new("UICorner", bg).CornerRadius = UDim.new(0, RADIUS-6)
	local s = Instance.new("UIStroke", bg)
	s.Thickness, s.Color, s.Transparency = 1, PALETTE.stroke, 0.88

	fill.BackgroundColor3 = fromCol
	fill.BorderSizePixel = 0
	Instance.new("UICorner", fill).CornerRadius = UDim.new(0, RADIUS-6)
	local g = Instance.new("UIGradient", fill)
	g.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, fromCol),
		ColorSequenceKeypoint.new(1, toCol),
	})
end

local function tweenBar(bar: Frame, pct: number)
	TweenService:Create(bar, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
		{Size = UDim2.new(math.clamp(pct,0,1),0,1,0)}):Play()
end

-- Utility: labels
local function makeLabel(name: string, parent: Instance)
	local lbl = Instance.new("TextLabel")
	lbl.Name = name
	lbl.Size = UDim2.new(1, 0, 0, 22)
	lbl.BackgroundTransparency = 1
	lbl.Font = Enum.Font.Gotham
	lbl.TextSize = 16
	lbl.TextColor3 = Color3.fromRGB(200, 255, 200)
	lbl.Text = name .. ": [N/A]"
	lbl.TextXAlignment = Enum.TextXAlignment.Left
	lbl.Parent = parent
	return lbl
end

-- Layouts for tabs
local function addListLayout(container: Frame)
	local pad = Instance.new("UIPadding", container)
	pad.PaddingTop = UDim.new(0, 6); pad.PaddingLeft = UDim.new(0, 6); pad.PaddingRight = UDim.new(0, 6)

	local list = Instance.new("UIListLayout", container)
	list.FillDirection = Enum.FillDirection.Vertical
	list.HorizontalAlignment = Enum.HorizontalAlignment.Left
	list.Padding = UDim.new(0, 6)
	return list
end

addListLayout(tab1Content)
addListLayout(tab2Content)

-- Tab1 labels
local tab1Labels = {
	Subject = makeLabel("Subject", tab1Content),
	Exposure = makeLabel("Exposure", tab1Content),
	Strength = makeLabel("Strength", tab1Content),
	Agility = makeLabel("Agility", tab1Content),
	Intelligence = makeLabel("Intelligence", tab1Content),
	MutationType = makeLabel("MutationType", tab1Content),
	PotentialEvolution = makeLabel("PotentialEvolution", tab1Content),
	HasReachedAdvancedMutation = makeLabel("AdvancedMutation", tab1Content),
	Weight = makeLabel("Weight", tab1Content),
	Health = makeLabel("Health", tab1Content),
}

-- Health bar (Tab1)
local healthBarBg = Instance.new("Frame")
healthBarBg.Size = UDim2.new(0.9, 0, 0, 18)
healthBarBg.BackgroundColor3 = PALETTE.surface2
healthBarBg.Parent = tab1Content

local healthBar = Instance.new("Frame")
healthBar.Size = UDim2.new(0, 0, 1, 0)
healthBar.Position = UDim2.new(0, 0, 0, 0)
healthBar.Parent = healthBarBg
styleBar(healthBarBg, healthBar, Color3.fromRGB(30,200,120), Color3.fromRGB(240,170,0))

-- Tab2 labels
local tab2Labels = {
	Resilience = makeLabel("Resilience", tab2Content),
	["Max Resilience"] = makeLabel("Max Resilience", tab2Content),
	WalkSpeed = makeLabel("WalkSpeed", tab2Content),
	["Speed Difference"] = makeLabel("Speed Difference", tab2Content),
	["Region Code"] = makeLabel("Region Code", tab2Content),
	["Is Elite"] = makeLabel("Is Elite", tab2Content),
	["Current Zone"] = makeLabel("Current Zone", tab2Content),
	Credits = makeLabel("Credits", tab2Content),
	["Active Perks"] = makeLabel("Active Perks", tab2Content),
}

-- Resilience bar (Tab2)
local resilienceBarBg = Instance.new("Frame")
resilienceBarBg.Size = UDim2.new(0.9, 0, 0, 16)
resilienceBarBg.BackgroundColor3 = PALETTE.surface2
resilienceBarBg.Parent = tab2Content

local resilienceBar = Instance.new("Frame")
resilienceBar.Size = UDim2.new(0, 0, 1, 0)
resilienceBar.Position = UDim2.new(0, 0, 0, 0)
resilienceBar.Parent = resilienceBarBg
styleBar(resilienceBarBg, resilienceBar, Color3.fromRGB(100,150,255), Color3.fromRGB(130,220,255))

-- Tab switching visuals
local currentTab = 1
local function setTabVisual(activeBtn: TextButton, inactiveBtn: TextButton)
	activeBtn.BackgroundColor3 = PALETTE.accent
	activeBtn.TextColor3 = PALETTE.text
	inactiveBtn.BackgroundColor3 = PALETTE.surface2
	inactiveBtn.TextColor3 = PALETTE.textSubtle
end

local function switchTab(tabNum: number)
	currentTab = tabNum
	if tabNum == 1 then
		tab1Content.Visible = true
		tab2Content.Visible = false
		setTabVisual(tab1Btn, tab2Btn)
	else
		tab1Content.Visible = false
		tab2Content.Visible = true
		setTabVisual(tab2Btn, tab1Btn)
	end
end

tab1Btn.MouseButton1Click:Connect(function() switchTab(1) end)
tab2Btn.MouseButton1Click:Connect(function() switchTab(2) end)
switchTab(1)

-- Dropdown build
local function updateDropdown(searchText: string)
	for _, child in ipairs(dropdown:GetChildren()) do
		if child:IsA("TextButton") then child:Destroy() end
	end
	searchText = (searchText or ""):lower()
	local results = {}

	-- two-pass: startswith first, then contains
	for _, p in ipairs(Players:GetPlayers()) do
		local nm = p.Name:lower()
		if searchText == "" or nm:sub(1, #searchText) == searchText then
			table.insert(results, p)
		end
	end
	for _, p in ipairs(Players:GetPlayers()) do
		local nm = p.Name:lower()
		if searchText ~= "" and nm:find(searchText, 1, true) and nm:sub(1, #searchText) ~= searchText then
			table.insert(results, p)
		end
	end

	for _, p in ipairs(results) do
		local btn = Instance.new("TextButton")
		btn.Size = UDim2.new(1, -8, 0, 28)
		btn.BackgroundColor3 = PALETTE.surface
		btn.Text = p.Name
		btn.Font = Enum.Font.Gotham
		btn.TextSize = 14
		btn.TextColor3 = PALETTE.text
		btn.TextXAlignment = Enum.TextXAlignment.Left
		btn.ZIndex = 11
		btn.Parent = dropdown
		Instance.new("UIPadding", btn).PaddingLeft = UDim.new(0, 10)
		Instance.new("UICorner", btn).CornerRadius = UDim.new(0, RADIUS-6)
		local s = Instance.new("UIStroke", btn)
		s.Thickness, s.Color, s.Transparency = 1, PALETTE.stroke, 0.9

		btn.MouseButton1Click:Connect(function()
			box.Text = p.Name
			dropdown.Visible = false
		end)
		btn.MouseEnter:Connect(function()
			TweenService:Create(btn, TweenInfo.new(0.1), {BackgroundColor3 = PALETTE.accent}):Play()
		end)
		btn.MouseLeave:Connect(function()
			TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = PALETTE.surface}):Play()
		end)
	end

	dropdown.CanvasSize = UDim2.new(0, 0, 0, dropdownList.AbsoluteContentSize.Y)
end

-- TextBox handlers (throttled)
local typingPending = false
box:GetPropertyChangedSignal("Text"):Connect(function()
	if not box:IsFocused() then return end
	if typingPending then return end
	typingPending = true
	task.delay(0.08, function()
		typingPending = false
		updateDropdown(box.Text)
	end)
end)

box.Focused:Connect(function()
	updateDropdown(box.Text)
	dropdown.Visible = true
	tab1Btn.Active = false
	tab2Btn.Active = false
end)

box.FocusLost:Connect(function()
	task.wait(0.1)
	dropdown.Visible = false
	tab1Btn.Active = true
	tab2Btn.Active = true
end)

-- Draggable frame (via title bar)
local dragging: boolean, dragInput, mousePos, framePos
titleBar.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		mousePos = input.Position
		framePos = frame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then dragging = false end
		end)
	end
end)
titleBar.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)
UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		local delta = input.Position - mousePos
		frame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X,
								   framePos.Y.Scale, framePos.Y.Offset + delta.Y)
	end
end)

-- Resizable frame (with clamp)
local resizing = false
local resizeStart, sizeStart
resizeHandle.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		resizing = true
		resizeStart = input.Position
		sizeStart = frame.Size
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then resizing = false end
		end)
	end
end)
UserInputService.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement and resizing then
		local delta = input.Position - resizeStart
		local newWidth  = math.clamp(sizeStart.X.Offset + delta.X, MIN_W, MAX_W)
		local newHeight = math.clamp(sizeStart.Y.Offset + delta.Y, MIN_H, MAX_H)
		frame.Size = UDim2.new(0, newWidth, 0, newHeight)
	end
end)

-- Toggle GUI with "P"
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.KeyCode == Enum.KeyCode.P then
		gui.Enabled = not gui.Enabled
	end
end)

--////////// Your original data logic (kept; small tweaks on visuals)

local function getCharacter(targetPlayer: Player?)
	if targetPlayer and targetPlayer.Character then
		return targetPlayer.Character
	end
	return nil
end

local function getHealth(char: Model)
	local humanoid = char and char:FindFirstChildOfClass("Humanoid")
	if humanoid then
		return humanoid.Health, humanoid.MaxHealth, humanoid
	end
	return nil, nil, nil
end

-- Update Tab 1 (Bio Data)
local function updateTab1(targetPlayer: Player)
	local char = getCharacter(targetPlayer)
	if not char then
		for _, lbl in pairs(tab1Labels) do lbl.Text = "[NO DATA]" end
		healthBar.Size = UDim2.new(0, 0, 1, 0)
		return
	end

	local function getCharAttr(attrName: string)
		return char:GetAttribute(attrName) or "N/A"
	end
	local function getPlayerAttr(attrName: string)
		return targetPlayer:GetAttribute(attrName) or "N/A"
	end

	local health, maxHealth = getHealth(char)

	tab1Labels.Subject.Text = "Subject: " .. targetPlayer.Name
	tab1Labels.Exposure.Text = "Exposure: " .. tostring(getCharAttr("Exposure"))
	tab1Labels.Strength.Text = "Strength: " .. tostring(getCharAttr("StrengthAttribute"))
	tab1Labels.Agility.Text = "Agility: " .. tostring(getCharAttr("AgilityAttribute"))
	tab1Labels.Intelligence.Text = "Intelligence: " .. tostring(getCharAttr("IntelligenceAttribute"))
	tab1Labels.MutationType.Text = "MutationType: " .. tostring(getCharAttr("MutationType"))
	tab1Labels.PotentialEvolution.Text = "PotentialEvolution: " .. tostring(getCharAttr("PotentialEvolution"))
	tab1Labels.HasReachedAdvancedMutation.Text = "AdvancedMutation: " .. tostring(getCharAttr("HasReachedAdvancedMutation"))

	local weight = getPlayerAttr("Weight")
	local weightNum = tonumber(weight)
	local weightText = "Weight: " .. tostring(weight) .. (weightNum and " kg" or "")
	if weightNum then
		local weightClass, weightColor = "", Color3.fromRGB(200,255,200)
		if math.abs(weightNum - 77.2) < 1e-6 then
			weightClass = " [PERFECT]"; weightColor = Color3.fromRGB(255,215,0)
		elseif weightNum >= 60 and weightNum < 80 then
			weightClass = " [Average]"; weightColor = Color3.fromRGB(100,255,100)
		elseif weightNum >= 80 and weightNum <= 120 then
			weightClass = " [Overweight]"; weightColor = Color3.fromRGB(255,150,100)
		elseif weightNum >= 50 and weightNum < 60 then
			weightClass = " [Underweight]"; weightColor = Color3.fromRGB(150,200,255)
		else
			weightClass = " [Out of Range]"; weightColor = Color3.fromRGB(255,100,100)
		end
		weightText ..= weightClass
		tab1Labels.Weight.TextColor3 = weightColor
	else
		tab1Labels.Weight.TextColor3 = Color3.fromRGB(200,255,200)
	end
	tab1Labels.Weight.Text = weightText

	if health and maxHealth and maxHealth > 0 then
		tab1Labels.Health.Text = string.format("Health: %d / %d", math.floor(health), math.floor(maxHealth))
		local pct = math.clamp(health / maxHealth, 0, 1)
		tweenBar(healthBar, pct)
	else
		tab1Labels.Health.Text = "Health: N/A"
		healthBar.Size = UDim2.new(0, 0, 1, 0)
	end
end

-- Update Tab 2 (Stats)
local function updateTab2(targetPlayer: Player)
	local char = getCharacter(targetPlayer)
	if not char then
		for _, lbl in pairs(tab2Labels) do lbl.Text = "[NO DATA]" end
		resilienceBar.Size = UDim2.new(0, 0, 1, 0)
		return
	end

	local function getCharAttr(attrName: string) return char:GetAttribute(attrName) end
	local function getPlayerAttr(attrName: string) return targetPlayer:GetAttribute(attrName) end

	local resilience = getPlayerAttr("Resilience") or getCharAttr("Resilience") or "N/A"
	local maxResilience = getPlayerAttr("MaxResilience") or getCharAttr("MaxResilience") or "N/A"

	tab2Labels.Resilience.Text = "Resilience: " .. tostring(resilience)
	tab2Labels["Max Resilience"].Text = "Max Resilience: " .. tostring(maxResilience)

	if typeof(resilience) == "number" and typeof(maxResilience) == "number" and maxResilience > 0 then
		tweenBar(resilienceBar, math.clamp(resilience / maxResilience, 0, 1))
	else
		resilienceBar.Size = UDim2.new(0, 0, 1, 0)
	end

	local humanoid = char:FindFirstChildOfClass("Humanoid")
	if humanoid then
		local currentSpeed = humanoid.WalkSpeed
		-- If 9/20 are game-specific, keep them; default Roblox is 16
		local defaultSpeed, runningSpeed = 9, 20
		local difference = currentSpeed - defaultSpeed
		local diffText = difference >= 0 and ("+" .. string.format("%.1f", difference)) or string.format("%.1f", difference)
		tab2Labels.WalkSpeed.Text = string.format("WalkSpeed: %.1f", currentSpeed)
		tab2Labels["Speed Difference"].Text = string.format("Speed Difference: %s (Default: %d | Run: %d)", diffText, defaultSpeed, runningSpeed)
	else
		tab2Labels.WalkSpeed.Text = "WalkSpeed: N/A"
		tab2Labels["Speed Difference"].Text = "Speed Difference: N/A"
	end

	local regionCode = getPlayerAttr("RegionCode") or getCharAttr("RegionCode") or "N/A"
	local isElite = getPlayerAttr("IsElite") or getCharAttr("IsElite") or "N/A"
	local currentZone = getPlayerAttr("CurrentZone") or getCharAttr("CurrentZone") or "N/A"
	tab2Labels["Region Code"].Text = "Region Code: " .. tostring(regionCode)
	tab2Labels["Is Elite"].Text = "Is Elite: " .. tostring(isElite)
	tab2Labels["Current Zone"].Text = "Current Zone: " .. tostring(currentZone)

	local dataFolder = targetPlayer:FindFirstChild("Data")
	local credits = "N/A"
	if dataFolder then
		local creditsValue = dataFolder:FindFirstChild("Credits")
		if creditsValue and typeof(creditsValue.Value) == "number" then
			local amount = math.floor(creditsValue.Value)
			credits = tostring(amount):reverse():gsub("(%d%d%d)", "%1,"):reverse():gsub("^,", "")
		end
	end
	tab2Labels.Credits.Text = "Credits: " .. tostring(credits)

	local activePerks = {}
	if dataFolder then
		for _, child in ipairs(dataFolder:GetChildren()) do
			if (child:IsA("BoolValue") and child.Value == true)
				or (child:IsA("IntValue") and child.Value > 0 and child.Name:lower():find("perk"))
			then
				table.insert(activePerks, child.Name)
			end
		end
	end
	tab2Labels["Active Perks"].Text = (#activePerks > 0) and ("Active Perks: " .. table.concat(activePerks, ", ")) or "Active Perks: None"
end

-- Light-weight refresh loop (throttled) to keep your existing model
local accum = 0
RunService.RenderStepped:Connect(function(dt)
	accum += dt
	if accum < 0.15 then return end -- ~6-7 updates/sec, smoother + cheaper
	accum = 0
	local targetName = box.Text
	local targetPlayer = (targetName == "" and player) or Players:FindFirstChild(targetName)
	if targetPlayer then
		updateTab1(targetPlayer)
		updateTab2(targetPlayer)
	end
end)
